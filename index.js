const blueCards = [
    {
        id: 'blue1',
        cardFace: 'assets/MythicCards/blue/blue1.png',
        difficulty: 'hard',
        color:'blue'
    },
    {
        id: 'blue2',
        cardFace: 'assets/MythicCards/blue/blue2.png',
        difficulty: 'hard',
        color:'blue'
    },
    {
        id: 'blue3',
        cardFace: 'assets/MythicCards/blue/blue3.png',
        difficulty: 'easy',
        color:'blue'
    },
    {
        id: 'blue4',
        cardFace: 'assets/MythicCards/blue/blue4.png',
        difficulty: 'easy',
        color:'blue'
    },
    {
        id: 'blue5',
        cardFace: 'assets/MythicCards/blue/blue5.png',
        difficulty: 'easy',
        color:'blue'
    },
    {
        id: 'blue6',
        cardFace: 'assets/MythicCards/blue/blue6.png',
        difficulty: 'hard',
        color:'blue'
    },
    {
        id: 'blue7',
        cardFace: 'assets/MythicCards/blue/blue7.png',
        difficulty: 'normal',
        color:'blue'
    },
    {
        id: 'blue8',
        cardFace: 'assets/MythicCards/blue/blue8.png',
        difficulty: 'hard',
        color:'blue'
    },
    {
        id: 'blue9',
        cardFace: 'assets/MythicCards/blue/blue9.png',
        difficulty: 'normal',
        color:'blue'
    },
    {
        id: 'blue10',
        cardFace: 'assets/MythicCards/blue/blue10.png',
        difficulty: 'easy',
        color:'blue'
    },
    {
        id: 'blue11',
        cardFace: 'assets/MythicCards/blue/blue11.png',
        difficulty: 'normal',
        color:'blue'
    },
    {
        id: 'blue12',
        cardFace: 'assets/MythicCards/blue/blue12.png',
        difficulty: 'normal',
        color:'blue'
    },
]

const brownCards = [
    {
        id: 'brown1',
        cardFace: 'assets/MythicCards/brown/brown1.png',
        difficulty: 'normal',
        color:'brown'
    },
    {
        id: 'brown2',
        cardFace: 'assets/MythicCards/brown/brown2.png',
        difficulty: 'normal',
        color:'brown'
    },
    {
        id: 'brown3',
        cardFace: 'assets/MythicCards/brown/brown3.png',
        difficulty: 'normal',
        color:'brown'
    },
    {
        id: 'brown4',
        cardFace: 'assets/MythicCards/brown/brown4.png',
        difficulty: 'normal',
        color:'brown'
    },
    {
        id: 'brown5',
        cardFace: 'assets/MythicCards/brown/brown5.png',
        difficulty: 'normal',
        color:'brown'
    },
    {
        id: 'brown6',
        cardFace: 'assets/MythicCards/brown/brown6.png',
        difficulty: 'hard',
        color:'brown'
    },
    {
        id: 'brown7',
        cardFace: 'assets/MythicCards/brown/brown7.png',
        difficulty: 'hard',
        color:'brown'
    },
    {
        id: 'brown8',
        cardFace: 'assets/MythicCards/brown/brown7.png',
        difficulty: 'hard',
        color:'brown'
    },
    {
        id: 'brown9',
        cardFace: 'assets/MythicCards/brown/brown7.png',
        difficulty: 'hard',
        color:'brown'
    },
    {
        id: 'brown10',
        cardFace: 'assets/MythicCards/brown/brown7.png',
        difficulty: 'hard',
        color:'brown'
    },
    {
        id: 'brown11',
        cardFace: 'assets/MythicCards/brown/brown7.png',
        difficulty: 'easy',
        color:'brown'
    },
    {
        id: 'brown12',
        cardFace: 'assets/MythicCards/brown/brown7.png',
        difficulty: 'easy',
        color:'brown'
    },
    {
        id: 'brown13',
        cardFace: 'assets/MythicCards/brown/brown7.png',
        difficulty: 'easy',
        color:'brown'
    },
    {
        id: 'brown14',
        cardFace: 'assets/MythicCards/brown/brown14.png',
        difficulty: 'easy',
        color:'brown'
    },
    {
        id: 'brown15',
        cardFace: 'assets/MythicCards/brown/brown15.png',
        difficulty: 'normal',
        color:'brown'
    },
    {
        id: 'brown16',
        cardFace: 'assets/MythicCards/brown/brown16.png',
        difficulty: 'normal',
        color:'brown'
    },
    {
        id: 'brown17',
        cardFace: 'assets/MythicCards/brown/brown17.png',
        difficulty: 'normal',
        color:'brown'
    },
    {
        id: 'brown18',
        cardFace: 'assets/MythicCards/brown/brown18.png',
        difficulty: 'normal',
        color:'brown'
    },
    {
        id: 'brown19',
        cardFace: 'assets/MythicCards/brown/brown19.png',
        difficulty: 'normal',
        color:'brown'
    },
    {
        id: 'brown20',
        cardFace: 'assets/MythicCards/brown/brown20.png',
        difficulty: 'normal',
        color:'brown'
    },
    {
        id: 'brown21',
        cardFace: 'assets/MythicCards/brown/brown21.png',
        difficulty: 'easy',
        color:'brown'
    },
]

const greenCards = [
    {
        id: 'green1',
        cardFace: 'assets/MythicCards/green/green1.png',
        difficulty: 'easy',
        color:'green'
    },
    {
        id: 'green2',
        cardFace: 'assets/MythicCards/green/green2.png',
        difficulty: 'hard',
        color:'green'
    },
    {
        id: 'green3',
        cardFace: 'assets/MythicCards/green/green3.png',
        difficulty: 'hard',
        color:'green'
    },
    {
        id: 'green4',
        cardFace: 'assets/MythicCards/green/green4.png',
        difficulty: 'hard',
        color:'green'
    },
    {
        id: 'green5',
        cardFace: 'assets/MythicCards/green/green5.png',
        difficulty: 'hard',
        color:'green'
    },
    {
        id: 'green6',
        cardFace: 'assets/MythicCards/green/green6.png',
        difficulty: 'hard',
        color:'green'
    },
    {
        id: 'green7',
        cardFace: 'assets/MythicCards/green/green7.png',
        difficulty: 'normal',
        color:'green'
    },
    {
        id: 'green8',
        cardFace: 'assets/MythicCards/green/green8.png',
        difficulty: 'normal',
        color:'green'
    },
    {
        id: 'green9',
        cardFace: 'assets/MythicCards/green/green9.png',
        difficulty: 'normal',
        color:'green'
    },
    {
        id: 'green10',
        cardFace: 'assets/MythicCards/green/green10.png',
        difficulty: 'normal',
        color:'green'
    },
    {
        id: 'green11',
        cardFace: 'assets/MythicCards/green/green11.png',
        difficulty: 'normal',
        color:'green'
    },
    {
        id: 'green12',
        cardFace: 'assets/MythicCards/green/green12.png',
        difficulty: 'easy',
        color:'green'
    },
    {
        id: 'green13',
        cardFace: 'assets/MythicCards/green/green13.png',
        difficulty: 'normal',
        color:'green'
    },
    {
        id: 'green14',
        cardFace: 'assets/MythicCards/green/green14.png',
        difficulty: 'normal',
        color:'green'
    },
    {
        id: 'green15',
        cardFace: 'assets/MythicCards/green/green15.png',
        difficulty: 'normal',
        color:'green'
    },
    {
        id: 'green16',
        cardFace: 'assets/MythicCards/green/green16.png',
        difficulty: 'easy',
        color:'green'
    },
    {
        id: 'green17',
        cardFace: 'assets/MythicCards/green/green17.png',
        difficulty: 'easy',
        color:'green'
    },
    {
        id: 'green18',
        cardFace: 'assets/MythicCards/green/green18.png',
        difficulty: 'easy',
        color:'green'
    },
]

const ancientsData = [
    {
        id: 'azathoth',
        name: 'azathoth',
        cardFace: "./assets/Ancients/Azathoth.png",
        firstStage: {
            greenCards: 1,
            blueCards: 1,
            brownCards: 2,
        },
        secondStage: {
            greenCards: 2,
            blueCards: 1,
            brownCards: 3,
        },
        thirdStage: {
            greenCards: 2,
            blueCards: 0,
            brownCards: 4,
        },
    },
    {
        id: 'cthulhu',
        name: 'cthulhu',
        cardFace: "./assets/Ancients/Cthulthu.png",
        firstStage: {
            greenCards: 0,
            blueCards: 2,
            brownCards: 2,
        },
        secondStage: {
            greenCards: 1,
            blueCards: 0,
            brownCards: 3,
        },
        thirdStage: {
            greenCards: 3,
            blueCards: 0,
            brownCards: 4,
        },
    },
    {
        id: 'iogSothoth',
        name: 'iogSothoth',
        cardFace: "./assets/Ancients/IogSothoth.png",
        firstStage: {
            greenCards: 0,
            blueCards: 1,
            brownCards: 2,
        },
        secondStage: {
            greenCards: 2,
            blueCards: 1,
            brownCards: 3,
        },
        thirdStage: {
            greenCards: 3,
            blueCards: 0,
            brownCards: 4,
        },
    },
    {
        id: 'shubNiggurath',
        name: 'shubNiggurath',
        cardFace: "./assets/Ancients/ShubNiggurath.png",
        firstStage: {
            greenCards: 1,
            blueCards: 1,
            brownCards: 2,
        },
        secondStage: {
            greenCards: 3,
            blueCards: 1,
            brownCards: 2,
        },
        thirdStage: {
            greenCards: 2,
            blueCards: 0,
            brownCards: 4,
        },
    },
]

const levelsData = [
    {
        id: "easier",
        name: "EASIER"
    },
    {
        id: "easy",
        name: "EASY"
    },
    {
        id: "normal",
        name: "NORMAL"
    },
    {
        id: "hard",
        name: "HARD"
    },
    {
        id: "harder",
        name: "HARDER"
    }]



// import ancientsData from "./data/ancients.js";
// import levelsData from "./data/levels.js";
// import {blueCards, brownCards, greenCards} from "./data/mythicCards/index.js"


const step_1 = document.querySelector('.step_1');
const btnStartGame = document.querySelector('.btn__start-game');
const btnNewGame = document.querySelector('.footer__btn');

btnStartGame.addEventListener('click', () => {
    step_1.classList.add('hidden');
    btnNewGame.classList.remove('hidden');
    displayAncientsPicker();
});


let selectedAncient = null;

function pickAncient(ancient) {
    selectedAncient = ancient;
}

function displayAncientsPicker() {
    let html = `<div class="step_2"><h2 class="step__title step_2__title">Choose your card</h2><div class="cards">`
    for (const ancient of ancientsData) {
        html += `<button id="${ancient.id}" class="btn-card"><img class="img" src="${ancient.cardFace}" alt="${ancient.name}" width="300"></button>`
    }
    html += "</div></div>"
    document.getElementById("board").innerHTML = html

    for (const ancient of ancientsData) {
        document.getElementById(ancient.id).addEventListener('click', () => {
                pickAncient(ancient);
                displayLevelsPicker();
            }
        )
    }
}

function displayLevelsPicker() {
    let html = `<div class="step_3"><h2 class="step__title step_3__title">Choose your level</h2><div class="levels">`
    for (const level of levelsData) {
        html += `<button id="${level.id}" class="level">${level.name}</button>`
    }
    html += "</div></div>"
    document.getElementById("board").innerHTML = html

    for (const level of levelsData) {
        document.getElementById(level.id).addEventListener('click', () => {
                pickLevel(level);
                displayMixCard();
            }
        )
    }
}

let selectedLevel = null;

function pickLevel(level) {
    selectedLevel = level;
}

function displayMixCard() {
    document.getElementById("board").innerHTML = `<button class="mix-cards"> MIX CARDS </button>`
    document.querySelector(".mix-cards").addEventListener('click', () => {
            mixCards();
            displayStages();
        }
    )
}

let cardsDeck = {
    firstStage: [],
    secondStage: [],
    thirdStage: [],
}

function mixCards() {
    greenCards.shuffle()
    brownCards.shuffle()
    blueCards.shuffle()

    const expectedGreenCount = selectedAncient.firstStage.greenCards + selectedAncient.secondStage.greenCards + selectedAncient.thirdStage.greenCards;
    const expectedBrownCount = selectedAncient.firstStage.brownCards + selectedAncient.secondStage.brownCards + selectedAncient.thirdStage.brownCards;
    const expectedBlueCount = selectedAncient.firstStage.blueCards + selectedAncient.secondStage.blueCards + selectedAncient.thirdStage.blueCards;

    let greenCardsDeck = null
    let brownCardsDeck = null
    let blueCardsDeck = null

    switch (selectedLevel.id) {
        case 'easier': {
            greenCardsDeck = pickEasierCards(expectedGreenCount, greenCards);
            brownCardsDeck = pickEasierCards(expectedBrownCount, brownCards);
            blueCardsDeck = pickEasierCards(expectedBlueCount, blueCards);

            function pickEasierCards(expectedCount, cards) {
                const cardDeck = [];
                let remaining = expectedCount
                for (let card of cards) {
                    if (card.difficulty === 'easy') {
                        cardDeck.push(card)
                        remaining--
                    }
                    if (remaining === 0) {
                        break
                    }
                }
                if (remaining > 0) {
                    for (let card of cards) {
                        if (card.difficulty === 'normal') {
                            cardDeck.push(card)
                            remaining--
                        }
                        if (remaining === 0) {
                            break
                        }
                    }
                }
                return cardDeck;
            }

            break;
        }
        case 'easy': {
            greenCardsDeck = pickEasyCards(expectedGreenCount, greenCards);
            brownCardsDeck = pickEasyCards(expectedBrownCount, brownCards);
            blueCardsDeck = pickEasyCards(expectedBlueCount, blueCards);

            function pickEasyCards(expectedCount, cards) {
                const cardDeck = [];
                let remaining = expectedCount
                for (let card of cards) {
                    if (card.difficulty !== 'hard') {
                        cardDeck.push(card)
                        remaining--
                    }
                    if (remaining === 0) {
                        break
                    }
                }
                return cardDeck;
            }

            break;
        }
        case 'normal': {
            greenCardsDeck = pickNormalCards(expectedGreenCount, greenCards);
            brownCardsDeck = pickNormalCards(expectedBrownCount, brownCards);
            blueCardsDeck = pickNormalCards(expectedBlueCount, blueCards);

            function pickNormalCards(expectedCount, cards) {
                const cardDeck = [];
                let remaining = expectedCount
                for (let card of cards) {
                    cardDeck.push(card)
                    remaining--
                    if (remaining === 0) {
                        break
                    }
                }
                return cardDeck;
            }

            break;
        }
        case 'hard': {
            greenCardsDeck = pickHardCards(expectedGreenCount, greenCards);
            brownCardsDeck = pickHardCards(expectedBrownCount, brownCards);
            blueCardsDeck = pickHardCards(expectedBlueCount, blueCards);

            function pickHardCards(expectedCount, cards) {
                const cardDeck = [];
                let remaining = expectedCount
                for (let card of cards) {
                    if (card.difficulty !== 'easy') {
                        cardDeck.push(card)
                        remaining--
                    }
                    if (remaining === 0) {
                        break
                    }
                }
                return cardDeck;
            }

            break;
        }
        case 'harder': {
            greenCardsDeck = pickHarderCards(expectedGreenCount, greenCards);
            brownCardsDeck = pickHarderCards(expectedBrownCount, brownCards);
            blueCardsDeck = pickHarderCards(expectedBlueCount, blueCards);

            function pickHarderCards(expectedCount, cards) {
                const cardDeck = [];
                let remaining = expectedCount
                for (let card of cards) {
                    if (card.difficulty === 'hard') {
                        cardDeck.push(card)
                        remaining--
                    }
                    if (remaining === 0) {
                        break
                    }
                }
                if (remaining > 0) {
                    for (let card of cards) {
                        if (card.difficulty === 'normal') {
                            cardDeck.push(card)
                            remaining--
                        }
                        if (remaining === 0) {
                            break
                        }
                    }
                }
                return cardDeck;
            }

            break;
        }
        default:
            throw new Error("Unsupported level:'" + selectedLevel.id + "'");
    }

    fillCards("greenCards", greenCardsDeck)
    fillCards("brownCards", brownCardsDeck)
    fillCards("blueCards", blueCardsDeck)

    cardsDeck.firstStage.shuffle()
    cardsDeck.secondStage.shuffle()
    cardsDeck.thirdStage.shuffle()
}

function fillCards(colorCards, colorCardsDesk) {
    let index = 0;
    cardsDeck.firstStage = cardsDeck.firstStage.concat(colorCardsDesk.slice(0, selectedAncient.firstStage[colorCards]))
    cardsDeck.secondStage = cardsDeck.secondStage.concat(colorCardsDesk.slice(selectedAncient.firstStage[colorCards], selectedAncient.firstStage[colorCards] + selectedAncient.secondStage[colorCards]))
    cardsDeck.thirdStage = cardsDeck.thirdStage.concat(colorCardsDesk.slice(selectedAncient.firstStage[colorCards] + selectedAncient.secondStage[colorCards]))
}

function displayStages() {
    document.getElementById("board").innerHTML =
        `<div class="stages">
            <div class="stage stage_1">
                <p class="stage__title"> First stage </p>
                <div class="circles">
                    <span id="first-green-count" class="circle green first-stage__green-cards">${selectedAncient.firstStage.greenCards}</span>
                    <span id="first-brown-count" class="circle red first-stage__red-cards">${selectedAncient.firstStage.brownCards}</span>
                    <span id="first-blue-count" class="circle blue first-stage__blue-cards">${selectedAncient.firstStage.blueCards}</span>
                </div>
            </div>
            <div class="stage stage_2">
                <p class="stage__title"> Second stage </p>
                <div class="circles">
                    <span id="second-green-count" class="circle green green-cards">${selectedAncient.secondStage.greenCards}</span>
                    <span id="second-brown-count" class="circle red">${selectedAncient.secondStage.brownCards}</span>
                    <span id="second-blue-count"  class="circle blue">${selectedAncient.secondStage.blueCards}</span>
                </div>
            </div>
            <div class="stage stage_3">
                <p class="stage__title"> Third stage </p>
                <div class="circles">
                    <span id="third-green-count" class="circle green green-cards">${selectedAncient.thirdStage.greenCards}</span>
                    <span id="third-brown-count" class="circle red">${selectedAncient.thirdStage.brownCards}</span>
                    <span id="third-blue-count"  class="circle blue">${selectedAncient.thirdStage.blueCards}</span>
                </div>
            </div>
          </div>
          <div class="play">
          <div id="deck">
              <button class="mythic-card-bg">
                <img class="img" src="./assets/mythicCardBackground.png" alt="mythic Card Background" width="250">
              </button>
          </div>
          <div id="open" class="card-open"></div>
          </div>
`

    document.getElementById('deck').addEventListener('click', () => {
        retrieveCard();
    })

}

function retrieveCard() {
    function updateCount(stage, card) {
        let id = stage + "-" + card.color + "-count";
        let count = parseInt(document.getElementById(id).innerHTML);
        document.getElementById(id).innerHTML = (--count).toString()
    }

    if (cardsDeck.firstStage.length > 0) {
        let card = cardsDeck.firstStage.shift();
        updateCount("first", card)
        displayCard(card)
    } else if (cardsDeck.secondStage.length > 0) {
        let card = cardsDeck.secondStage.shift();
        updateCount("second", card)
        displayCard(card)
    } else if (cardsDeck.thirdStage.length > 0) {
        let card = cardsDeck.thirdStage.shift();
        updateCount("third", card)
        displayCard(card)
        if (cardsDeck.thirdStage.length === 0) {
            document.getElementById("deck").innerHTML = ""
        }
    }
}

function displayCard(card) {
    document.getElementById("open").innerHTML = `<img class="img" src="${card.cardFace}" alt="${card.cardFace}" width="250">`
}

Array.prototype.shuffle = function () {
    let currentIndex = this.length,  randomIndex;

    while (currentIndex !== 0) {
        randomIndex = Math.floor(Math.random() * currentIndex);
        currentIndex--;
        [this[currentIndex], this[randomIndex]] = [
            this[randomIndex], this[currentIndex]];
    }
    
    return this;
}